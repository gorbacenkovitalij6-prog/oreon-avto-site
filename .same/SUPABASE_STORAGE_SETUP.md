# üì¶ –ù–ê–°–¢–†–û–ô–ö–ê SUPABASE STORAGE –î–õ–Ø –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—è —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å –≤—ã–±–∏–≤–∞–µ—Ç –æ—à–∏–±–∫—É "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ —Å–æ–∑–¥–∞–Ω bucket –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å Storage Bucket

1. –ó–∞–π–¥–∏—Ç–µ –≤ Supabase Dashboard
2. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –í –ª–µ–≤–æ–º –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ **Storage**
4. –ù–∞–∂–º–∏—Ç–µ **"New bucket"** (–∏–ª–∏ **"Create bucket"**)
5. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
   - **Name:** `car-images`
   - **Public bucket:** ‚úÖ **–í–∫–ª—é—á–∏—Ç—å** (—á—Ç–æ–±—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±—ã–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –ø—É–±–ª–∏—á–Ω–æ)
   - **File size limit:** `5 MB`
   - **Allowed MIME types:** –û—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º –∏–ª–∏ —É–∫–∞–∑–∞—Ç—å `image/jpeg, image/png, image/webp`
6. –ù–∞–∂–º–∏—Ç–µ **"Create bucket"**

---

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ (Policies)

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è bucket –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –†–∞–∑—Ä–µ—à–∏—Ç—å –≤—Å–µ–º –∑–∞–≥—Ä—É–∂–∞—Ç—å (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Storage** ‚Üí **Policies**
2. –ù–∞–π–¥–∏—Ç–µ bucket `car-images`
3. –ù–∞–∂–º–∏—Ç–µ **"New Policy"**
4. –í—ã–±–µ—Ä–∏—Ç–µ **"For full customization"**
5. –°–æ–∑–¥–∞–π—Ç–µ 3 –ø–æ–ª–∏—Ç–∏–∫–∏:

**–ü–æ–ª–∏—Ç–∏–∫–∞ 1: –ó–∞–≥—Ä—É–∑–∫–∞ (INSERT)**
```sql
-- Policy name: Allow authenticated uploads
-- Allowed operation: INSERT

CREATE POLICY "Allow authenticated uploads"
ON storage.objects FOR INSERT
TO authenticated
WITH CHECK (bucket_id = 'car-images');
```

**–ü–æ–ª–∏—Ç–∏–∫–∞ 2: –ß—Ç–µ–Ω–∏–µ (SELECT)**
```sql
-- Policy name: Public read access
-- Allowed operation: SELECT

CREATE POLICY "Public read access"
ON storage.objects FOR SELECT
TO public
USING (bucket_id = 'car-images');
```

**–ü–æ–ª–∏—Ç–∏–∫–∞ 3: –£–¥–∞–ª–µ–Ω–∏–µ (DELETE)**
```sql
-- Policy name: Allow authenticated deletes
-- Allowed operation: DELETE

CREATE POLICY "Allow authenticated deletes"
ON storage.objects FOR DELETE
TO authenticated
USING (bucket_id = 'car-images');
```

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä–æ—Å—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (Quick setup)

–ï—Å–ª–∏ –≤ Supabase –µ—Å—Ç—å –æ–ø—Ü–∏—è **"Quick setup"**:
1. –í—ã–±–µ—Ä–∏—Ç–µ bucket `car-images`
2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Ç—Ä–∏ —Ç–æ—á–∫–∏ (‚ãÆ)
3. –í—ã–±–µ—Ä–∏—Ç–µ **"Edit bucket"** –∏–ª–∏ **"Policies"**
4. –í–∫–ª—é—á–∏—Ç–µ:
   - ‚úÖ **Public read access** (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
   - ‚úÖ **Authenticated write access** (–¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏)

---

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Storage** ‚Üí **car-images**
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Supabase
3. –ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ - bucket –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ!

---

## üîß –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–û–ï –†–ï–®–ï–ù–ò–ï: –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å –ë–ï–ó —Ñ–æ—Ç–æ

–ï—Å–ª–∏ Storage –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–ª–æ–∂–Ω–æ, –º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª–∏ –±–µ–∑ —Ñ–æ—Ç–æ:

1. –í –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏ –ø—Ä–æ—Å—Ç–æ **–Ω–µ –≤—ã–±–∏—Ä–∞–π—Ç–µ —Ñ–æ—Ç–æ**
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
3. –ù–∞–∂–º–∏—Ç–µ **"–î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å"**

–ö–æ–¥ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª—É—á–∞–π –±–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –∞–≤—Ç–æ–º–æ–±–∏–ª—å –¥–æ–±–∞–≤–∏—Ç—Å—è —Å –ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º `images: []`.

---

## üìã –ü–†–û–í–ï–†–û–ß–ù–´–ô –°–ü–ò–°–û–ö

–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –≤—Å–µ –µ—â–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

- [ ] Bucket `car-images` —Å–æ–∑–¥–∞–Ω –≤ Storage
- [ ] Bucket –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–∞–∫ **Public**
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ (Policies)
- [ ] –í—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏ (–µ—Å—Ç—å —Å–µ—Å—Å–∏—è)
- [ ] –í —Ç–∞–±–ª–∏—Ü–µ `cars` –µ—Å—Ç—å –≤—Å–µ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è:
  - `brand`, `model`, `year`, `price`, `mileage`
  - `fuel_type`, `transmission`, `description`
  - `engine_volume`, `drive_type`
  - `images` (—Ç–∏–ø: text[] –∏–ª–∏ jsonb)
  - `location`, `status`

---

## üêõ –û–¢–õ–ê–î–ö–ê –û–®–ò–ë–û–ö

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞ (–≤–µ—Ä—Å–∏—è 117+) –≤—ã –±—É–¥–µ—Ç–µ –≤–∏–¥–µ—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏:

```
‚ùå –û–®–ò–ë–ö–ê:

–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ photo.jpg:
new row violates row-level security policy for table "objects"

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.
```

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ–ª–Ω—ã–π –ª–æ–≥ –æ—à–∏–±–∫–∏
3. –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ "row-level security policy" - –ø—Ä–æ–±–ª–µ–º–∞ –≤ –ø–æ–ª–∏—Ç–∏–∫–∞—Ö Storage
4. –ï—Å–ª–∏ "relation does not exist" - –ø—Ä–æ–±–ª–µ–º–∞ —Å —Ç–∞–±–ª–∏—Ü–µ–π cars
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ –∏ –Ω–∞–π–¥–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ

---

## üìû –ß–ê–°–¢–´–ï –û–®–ò–ë–ö–ò

### –û—à–∏–±–∫–∞: "new row violates row-level security"
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ (—Å–º. –®–∞–≥ 2)

### –û—à–∏–±–∫–∞: "Bucket not found"
**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–π—Ç–µ bucket `car-images` (—Å–º. –®–∞–≥ 1)

### –û—à–∏–±–∫–∞: "Invalid JWT token"
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ `/login`

### –û—à–∏–±–∫–∞: "column does not exist"
**–†–µ—à–µ–Ω–∏–µ:** –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é `.same/supabase-migration-add-fields.sql`

---

## ‚úÖ –ì–û–¢–û–í–û!

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Storage –≤—ã —Å–º–æ–∂–µ—Ç–µ:
- ‚úÖ –ó–∞–≥—Ä—É–∂–∞—Ç—å –¥–æ 10 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è
- ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –ø—É–±–ª–∏—á–Ω–æ
- ‚úÖ –§–∞–π–ª—ã –¥–æ 5MB –∫–∞–∂–¥—ã–π
- ‚úÖ –§–æ—Ä–º–∞—Ç—ã: JPG, PNG, WebP

---

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å —Å–Ω–æ–≤–∞ —á–µ—Ä–µ–∑ `/admin`
